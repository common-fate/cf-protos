syntax = "proto3";

package team.v1alpha1;

import "gconfig/v1alpha1/gconfig.proto";

// TeamService is used to manage Granted teams.
service TeamService {
  rpc ListMembers(ListMembersRequest) returns (ListMembersResponse);
  rpc UpdateConfig(UpdateConfigRequest) returns (UpdateConfigResponse);
  // GetConfig returns the latest approved config
  rpc GetConfig(GetConfigRequest) returns (GetConfigResponse);
  rpc GetConfigByHash(GetConfigByHashRequest) returns (GetConfigByHashResponse);
  rpc GetInterventions(GetInterventionsRequest) returns (GetInterventionsResponse);
  // rpc GetProviders(GetProvidersRequest) returns (GetProvidersResponse);
}

message ListMembersRequest {}

message ListMembersResponse {
	repeated Member members = 1;
}

message Member {
	string email_address = 1;
	bool is_admin = 2;
}

message UpdateConfigRequest {
  gconfig.v1alpha1.Config config = 1;
};

message UpdateConfigResponse {
  bytes sha256_hash = 1;
}

message GetConfigRequest {}

message GetConfigResponse {
  gconfig.v1alpha1.Config config = 1;
}

message GetConfigByHashRequest {
  bytes sha256_hash = 1;
}

message GetConfigByHashResponse {
  gconfig.v1alpha1.Config config = 1;
}


message EnrolAWSProviderIntervention {
  string provider_id = 1;
  string aws_account_id = 2;
  string cloudformation_url = 3;
}

message GetInterventionsRequest {}

// Interventions are steps which we require the user to complete manually so that Granted works properly.
message Intervention {
  oneof data {
    EnrolAWSProviderIntervention enrol_aws_provider = 1;
  }
}

message GetInterventionsResponse {
  repeated Intervention interventions = 1;
}

// message GetProvidersRequest {}

// // TODO: this should be shifted into gconfig.v1alpha1.Config
// message Provider {
//   string id = 1;
//   string type = 2;
//   oneof status {
//     EnrollmentRequired enrollment_required = 3;
//     ProviderActive active = 4;
//   }

//   oneof data {
//     AWSRoleProvider aws_role = 8;
//   }
// }

// message AWSRoleProvider {
//   string bastion_account_id = 1;
// }

// message EnrollmentRequired {
//   string deployment_url = 1;
// }

// message ProviderActive {}

// message GetProvidersResponse {
//   repeated Provider providers = 1;
// }
